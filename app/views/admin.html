<!-- Admin Dashboard View -->
<div class="admin-layout">
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 d-md-block admin-sidebar">
                <div class="admin-sidebar-content">
                    <div class="admin-sidebar-header">
                        <h5 class="admin-sidebar-title">
                            <i class="bi bi-shield-check"></i>
                            Quản trị hệ thống
                        </h5>
                    </div>
                    <nav class="admin-nav">
                        <ul class="admin-nav-list" ng-if="!isDeliveryOnly">
                            <li class="admin-nav-item">
                                <a class="admin-nav-link active" href="#!/admin">
                                    <i class="bi bi-speedometer2"></i>
                                    <span>Dashboard</span>
                                </a>
                            </li>
                            <li class="admin-nav-item">
                                <a class="admin-nav-link" href="#!/admin/categories">
                                    <i class="bi bi-tags"></i>
                                    <span>Danh mục</span>
                                </a>
                            </li>
                            <li class="admin-nav-item">
                                <a class="admin-nav-link" href="#!/admin/books">
                                    <i class="bi bi-book"></i>
                                    <span>Quản lý sách</span>
                                </a>
                            </li>
                            <li class="admin-nav-item">
                                <a class="admin-nav-link" href="#!/admin/orders">
                                    <i class="bi bi-cart-check"></i>
                                    <span>Đơn hàng</span>
                                </a>
                            </li>
                            <li class="admin-nav-item">
                                <a class="admin-nav-link" href="#!/admin/purchase-orders">
                                    <i class="bi bi-cart-plus"></i>
                                    <span>Đơn đặt hàng</span>
                                </a>
                            </li>
                            <li class="admin-nav-item">
                                <a class="admin-nav-link" href="#!/admin/goods-receipts">
                                    <i class="bi bi-box-seam"></i>
                                    <span>Phiếu nhập</span>
                                </a>
                            </li>
                            <li class="admin-nav-item">
                                <a class="admin-nav-link" href="#!/admin/returns">
                                    <i class="bi bi-arrow-counterclockwise"></i>
                                    <span>Phiếu trả</span>
                                </a>
                            </li>
                            <li class="admin-nav-item">
                                <a class="admin-nav-link" href="#!/admin/users">
                                    <i class="bi bi-people"></i>
                                    <span>Người dùng</span>
                                </a>
                            </li>
                            <li class="admin-nav-item">
                                <a class="admin-nav-link" href="#!/admin/roles" admin-only>
                                    <i class="bi bi-shield-lock"></i>
                                    <span>Phân quyền</span>
                                </a>
                            </li>
                            <li class="admin-nav-item">
                                <a class="admin-nav-link" href="#!/admin/reports/revenue">
                                    <i class="bi bi-graph-up"></i>
                                    <span>Báo cáo doanh thu</span>
                                </a>
                            </li>
                            <li class="admin-nav-item">
                                <a class="admin-nav-link" href="#!/admin/reports/inventory">
                                    <i class="bi bi-boxes"></i>
                                    <span>Báo cáo tồn kho</span>
                                </a>
                            </li>
                            <li class="admin-nav-item">
                                <a class="admin-nav-link" href="#!/admin/promotions">
                                    <i class="bi bi-gift"></i>
                                    <span>Khuyến mãi</span>
                                </a>
                            </li>
                            <li class="admin-nav-item">
                                <a class="admin-nav-link" href="#!/admin/settings">
                                    <i class="bi bi-gear"></i>
                                    <span>Cài đặt</span>
                                </a>
                            </li>
                        </ul>
                        <ul class="admin-nav-list" ng-if="isDeliveryOnly">
                            <li class="admin-nav-item">
                                <a class="admin-nav-link active" href="#!/delivery/orders">
                                    <i class="bi bi-truck"></i>
                                    <span>Đơn được phân công</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 admin-main-content" ng-class="{'no-scroll': showingDashboardReport || showingDashboardInventory || showingDashboardProfit}">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Dashboard Admin</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group me-2">
                        <button type="button" class="btn btn-sm btn-outline-secondary">
                            <i class="bi bi-download"></i> Export
                        </button>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="row mb-md">
                <div class="col-xl-3 col-md-6 mb-md">
                    <div class="card card-sm card-primary">
                        <div class="card-body p-md">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-sm">
                                        Tổng người dùng
                                    </div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">{{stats.totalUsers}}</div>
                                </div>
                                <div class="col-auto">
                                    <i class="bi bi-people icon-lg text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-md">
                    <div class="card card-sm card-success">
                        <div class="card-body p-md">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-success text-uppercase mb-sm">
                                        Tổng sách
                                    </div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">{{stats.totalBooks}}</div>
                                </div>
                                <div class="col-auto">
                                    <i class="bi bi-book icon-lg text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-md">
                    <div class="card card-sm card-info">
                        <div class="card-body p-md">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-info text-uppercase mb-sm">
                                        Đơn hàng hôm nay
                                    </div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">{{stats.todayOrders}}</div>
                                </div>
                                <div class="col-auto">
                                    <i class="bi bi-cart-check icon-lg text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-md">
                    <div class="card card-sm card-warning">
                        <div class="card-body p-md">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-warning text-uppercase mb-sm">
                                        Doanh thu tháng
                                    </div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">{{stats.monthlyRevenue | currency:'VND '}}</div>
                                </div>
                                <div class="col-auto">
                                    <i class="bi bi-currency-dollar icon-lg text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Dashboard Reports: Báo cáo tổng quan -->
<div class="row mb-4">
  <!-- Doanh thu -->
  <div class="col-lg-6 mb-4">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>
          <i class="bi bi-graph-up"></i> Báo cáo doanh thu
        </span>
      </div>
      <div class="card-body">
        <!-- Summary revenue -->
        <div class="mb-3" ng-if="revenueSummary">
          <div class="alert alert-light border shadow-sm mb-0">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <strong>Tổng doanh thu:</strong>
                <span class="text-primary fw-bold">{{revenueSummary.total | vnNumber:0}} VNĐ</span>
              </div>
              <div class="text-muted small">
                {{revenueSummary.fromDate | date:'dd/MM/yyyy'}} - {{revenueSummary.toDate | date:'dd/MM/yyyy'}}
              </div>
            </div>
          </div>
        </div>
        <!-- Báo cáo doanh thu (sửa code html form) -->
<form class="dashboard-flex-form mb-3" autocomplete="off" ng-submit="viewRevenueReport(true)">
  <div>
    <label class="form-label">Loại báo cáo:</label>
    <select class="form-select" ng-model="revenueFilter.type">
      <option value="daily">Ngày</option>
      <option value="monthly">Tháng</option>
      <option value="quarterly">Quý</option>
    </select>
  </div>
  <div>
    <label class="form-label">Từ ngày:</label>
    <input type="date" class="form-control" ng-model="revenueFilter.fromDate">
  </div>
  <div>
    <label class="form-label">Đến ngày:</label>
    <input type="date" class="form-control" ng-model="revenueFilter.toDate">
  </div>
  <div>
    <label class="form-label" style="opacity:0;">&nbsp;</label>
    <button class="btn btn-primary w-100" type="submit" ng-disabled="loadingRevenue">
      <i class="bi bi-search"></i> Xem báo cáo
    </button>
  </div>
</form>
        
      </div>
    </div>
  </div>

  <!-- Tồn kho -->
  <div class="col-lg-6 mb-4">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>
          <i class="bi bi-boxes"></i> Báo cáo tồn kho
        </span>
      </div>
      <div class="card-body">
        <!-- Summary inventory -->
        <div class="mb-3" ng-if="inventorySummary">
          <div class="alert alert-light border shadow-sm mb-2">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <strong>Tổng trị giá tồn kho:</strong>
                <span class="text-success fw-bold">{{inventorySummary.totalValue | vnNumber:0}} VNĐ</span>
              </div>
              <div class="text-muted small">Tổng SL tồn: {{inventorySummary.totalQuantity | number}}</div>
            </div>
          </div>
        </div>
        <!-- Báo cáo tồn kho (sửa code html form) -->
<form class="dashboard-flex-form mb-3" autocomplete="off" ng-submit="viewInventoryReport(true)">
  <div>
    <label class="form-label">Tính đến ngày:</label>
    <input type="date" class="form-control" ng-model="inventoryFilter.toDate">
  </div>
  <div>
    <label class="form-label" style="opacity:0;">&nbsp;</label>
    <button class="btn btn-primary w-100" type="submit" ng-disabled="loadingInventory">
      <i class="bi bi-search"></i> Xem báo cáo
    </button>
  </div>
</form>
        
      </div>
    </div>
  </div>
</div>

<!-- Profit report row -->
<div class="row mb-4">
  <div class="col-lg-6 mb-4">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>
          <i class="bi bi-cash-coin"></i> Báo cáo lợi nhuận
        </span>
      </div>
      <div class="card-body">
        <!-- Summary profit -->
        <div class="mb-3" ng-if="profitSummary">
          <div class="alert alert-light border shadow-sm mb-0">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <strong>Lợi nhuận:</strong>
                <span class="fw-bold" ng-class="{'text-success': (profitSummary.profit||0) >= 0, 'text-danger': (profitSummary.profit||0) < 0}">{{profitSummary.profit | vnNumber:0}} VNĐ</span>
              </div>
              <div class="text-muted small">{{profitSummary.fromDate | date:'dd/MM/yyyy'}} - {{profitSummary.toDate | date:'dd/MM/yyyy'}}</div>
            </div>
          </div>
        </div>

        <form class="dashboard-flex-form mb-3" autocomplete="off" ng-submit="viewProfitReport(true)">
          <div>
            <label class="form-label">Từ ngày:</label>
            <input type="date" class="form-control" ng-model="profitFilter.fromDate">
          </div>
          <div>
            <label class="form-label">Đến ngày:</label>
            <input type="date" class="form-control" ng-model="profitFilter.toDate">
          </div>
          <div>
            <label class="form-label" style="opacity:0;">&nbsp;</label>
            <button class="btn btn-primary w-100" type="submit" ng-disabled="loadingProfit">
              <i class="bi bi-search"></i> Xem báo cáo
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div class="col-lg-6 mb-4">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>
          <i class="bi bi-pie-chart"></i> Tỷ lệ sách theo danh mục
        </span>
      </div>
      <div class="card-body">
        <div class="row align-items-center">
          <div class="col-md-6 d-flex justify-content-center mb-3 mb-md-0">
            <div class="pie-chart" ng-style="{'background': 'conic-gradient(' + (categoryPie.gradient||'transparent') + ')'}"></div>
          </div>
          <div class="col-md-6">
            <ul class="pie-legend list-unstyled mb-0">
              <li class="d-flex align-items-center mb-2" ng-repeat="it in categoryPie.items">
                <span class="legend-dot" ng-style="{'background-color': it.color}"></span>
                <span class="flex-grow-1">{{it.label}}</span>
                <strong class="ms-2">{{it.percent | number:1}}%</strong>
              </li>
              <li ng-if="!categoryPie.items || categoryPie.items.length==0" class="text-muted">Chưa có dữ liệu.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

        
        <!-- Báo cáo doanh thu modal (đặt trong layout để dùng chung scope) -->
        <div class="dashboard-backdrop" ng-show="showingDashboardReport" ng-click="showingDashboardReport=false"></div>
        <div class="dashboard-report-modal" id="revenueReportModal" ng-show="showingDashboardReport">
  <div class="modal-content" ng-click="$event.stopPropagation()">
    <div class="modal-header">
      <h5 class="modal-title"><i class="bi bi-bar-chart-line me-2"></i>Preview Báo Cáo Doanh Thu</h5>
      <div class="d-flex align-items-center" style="gap:8px;">
        <button type="button" class="btn btn-sm btn-light" ng-click="$event.stopPropagation(); exportRevenuePdf()">
          <i class="bi bi-download"></i> Tải PDF
        </button>
        <button type="button" class="btn-close" ng-click="$event.stopPropagation(); showingDashboardReport=false"></button>
      </div>
    </div>
    <div class="modal-body">
      <div ng-if="revenueReportData">
        <div class="report-header">
          <div class="brand">
            <div class="brand-name">BookStore</div>
            <div class="brand-sub">Hệ thống quản trị báo cáo</div>
          </div>
          <div class="report-meta">
            <div class="meta-item"><span>Thời gian:</span>
              <strong>{{revenueFilter.fromDate | date:'dd/MM/yyyy'}} - {{revenueFilter.toDate | date:'dd/MM/yyyy'}}</strong>
            </div>
            <div class="meta-item"><span>Ngày báo cáo:</span><strong>{{ now | date:'dd/MM/yyyy HH:mm' }}</strong></div>
            <div class="meta-item"><span>Người lập:</span>
              <strong>{{getReporterName(reportGeneratedBy) || getReporterName()}}</strong>
              <span class="text-muted" ng-if="(reportGeneratedBy && reportGeneratedBy.email)">&lt;{{reportGeneratedBy.email}}&gt;</span>
              <span class="text-muted" ng-if="!(reportGeneratedBy && reportGeneratedBy.email) && currentUser.email">&lt;{{currentUser.email}}&gt;</span>
            </div>
          </div>
        </div>
        <h2 class="report-title">BÁO CÁO DOANH THU {{revenueFilter.type == 'daily' ? 'Ngày' : revenueFilter.type == 'monthly' ? 'Tháng' : 'Quý' | uppercase}}</h2>
        <div class="mb-4">
          <table class="table table-bordered">
            <thead class="table-light">
              <tr><th>{{getRevenueHeader()}}</th><th>Doanh Thu (VND)</th></tr>
            </thead>
            <tbody>
              <tr ng-repeat="item in revenueReportData">
                <td ng-bind="item.label"></td>
                <td ng-bind="item.value | vnNumber:0"></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="h4 fw-bold text-end">Tổng doanh thu: <span class="text-danger">{{revenueReportTotal | vnNumber:0}} VNĐ</span></div>
        <div class="fw-bold mt-4 mb-1" style="text-align:right">Người phê duyệt</div>
        <div class="fst-italic" style="text-align:right">(Ký và ghi rõ họ & tên)</div>
      </div>
      <div ng-if="!revenueReportData" class="text-center text-muted">Chưa có dữ liệu xem chi tiết.</div>
    </div>
  </div>
        </div>

        <!-- Báo cáo tồn kho modal -->
        <div class="inventory-backdrop" ng-show="showingDashboardInventory" ng-click="showingDashboardInventory=false"></div>
        <div class="inventory-report-modal" id="inventoryReportModal" ng-show="showingDashboardInventory">
  <div class="modal-content" ng-click="$event.stopPropagation()">
    <div class="modal-header">
      <h5 class="modal-title"><i class="bi bi-archive me-2"></i> Báo Cáo Tồn Kho</h5>
      <div class="d-flex align-items-center" style="gap:8px;">
        <button type="button" class="btn btn-sm btn-light" ng-click="$event.stopPropagation(); exportInventoryPdf()">
          <i class="bi bi-download"></i> Tải PDF
        </button>
        <button type="button" class="btn-close" ng-click="$event.stopPropagation(); showingDashboardInventory=false"></button>
      </div>
    </div>
    <div class="modal-body">
      <div ng-if="inventoryReportData">
        <div class="report-header">
          <div class="brand">
            <div class="brand-name">BookStore</div>
            <div class="brand-sub">Hệ thống quản trị báo cáo</div>
          </div>
          <div class="report-meta">
            <div class="meta-item"><span>Tính đến ngày:</span><strong>{{inventoryFilter.toDate | date:'dd/MM/yyyy'}}</strong></div>
            <div class="meta-item"><span>Ngày báo cáo:</span><strong>{{ now | date:'dd/MM/yyyy HH:mm' }}</strong></div>
            <div class="meta-item"><span>Người lập:</span>
              <strong>{{getReporterName(reportGeneratedByInventory) || getReporterName()}}</strong>
              <span class="text-muted" ng-if="(reportGeneratedByInventory && reportGeneratedByInventory.email)">&lt;{{reportGeneratedByInventory.email}}&gt;</span>
              <span class="text-muted" ng-if="!(reportGeneratedByInventory && reportGeneratedByInventory.email) && currentUser.email">&lt;{{currentUser.email}}&gt;</span>
            </div>
          </div>
        </div>

        
        <h2 class="report-title">BÁO CÁO TỒN KHO</h2>
        <div>
          <table class="table table-bordered">
            <thead class="table-light">
              <tr>
                <th>STT</th>
                <th>ISBN</th>
                <th>Tên sách</th>
                <th class="text-end">SL tồn</th>
                <th class="text-end">Đơn giá TB</th>
                <th class="text-end">Trị giá</th>
              </tr>
            </thead>
            <tbody ng-repeat="grp in inventoryGroups">
              <tr class="table-secondary">
                <td colspan="6"><strong>{{grp.category}}</strong></td>
              </tr>
              <tr ng-repeat="item in grp.items">
                <td>{{$index+1}}</td>
                <td><code>{{item.isbn}}</code></td>
                <td>{{item.title}}</td>
                <td class="text-end">{{item.quantityOnHand | number}}</td>
                <td class="text-end">{{item.averagePrice | vnNumber:0}}</td>
                <td class="text-end">{{item.value | vnNumber:0}}</td>
              </tr>
              <tr>
                <td colspan="5" class="text-end"><strong>Tổng trị giá</strong></td>
                <td class="text-end"><strong>{{grp.subtotal | vnNumber:0}} VNĐ</strong></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="h4 fw-bold text-end mt-2">TỔNG TRỊ GIÁ TỒN KHO: <span class="text-dark">{{inventoryReportTotal | vnNumber:0}} VNĐ</span></div>
        <div class="fw-bold mt-4 mb-1" style="text-align:right">Người phê duyệt</div>
        <div class="fst-italic" style="text-align:right">(Ký và ghi rõ họ & tên)</div>
      </div>
      <div ng-if="!inventoryReportData" class="text-center text-muted">Chưa có dữ liệu xem chi tiết.</div>
    </div>
  </div>
        </div>

        <!-- Báo cáo lợi nhuận modal -->
        <div class="profit-backdrop" ng-show="showingDashboardProfit" ng-click="showingDashboardProfit=false"></div>
        <div class="profit-report-modal" id="profitReportModal" ng-show="showingDashboardProfit">
  <div class="modal-content" ng-click="$event.stopPropagation()">
    <div class="modal-header">
      <h5 class="modal-title"><i class="bi bi-cash-coin me-2"></i> Báo Cáo Lợi Nhuận</h5>
      <div class="d-flex align-items-center" style="gap:8px;">
        <button type="button" class="btn btn-sm btn-light" ng-click="$event.stopPropagation(); exportProfitPdf()">
          <i class="bi bi-download"></i> Tải PDF
        </button>
        <button type="button" class="btn-close" ng-click="$event.stopPropagation(); showingDashboardProfit=false"></button>
      </div>
    </div>
    <div class="modal-body">
      <div ng-if="loadingProfit" class="text-center py-4">
        <div class="spinner-border text-primary" role="status"></div>
        <div class="text-muted mt-2">Đang tải báo cáo...</div>
      </div>
      <div ng-if="!loadingProfit && profitReportData">
        <div class="report-header">
          <div class="brand">
            <div class="brand-name">BookStore</div>
            <div class="brand-sub">Hệ thống quản trị báo cáo</div>
          </div>
          <div class="report-meta">
            <div class="meta-item"><span>Thời gian:</span><strong>{{profitFilter.fromDate | date:'dd/MM/yyyy'}} - {{profitFilter.toDate | date:'dd/MM/yyyy'}}</strong></div>
            <div class="meta-item"><span>Ngày báo cáo:</span><strong>{{ now | date:'dd/MM/yyyy HH:mm' }}</strong></div>
            <div class="meta-item"><span>Người lập:</span>
              <strong>{{getReporterName(reportGeneratedByProfit) || getReporterName()}}</strong>
              <span class="text-muted" ng-if="(reportGeneratedByProfit && reportGeneratedByProfit.email)">&lt;{{reportGeneratedByProfit.email}}&gt;</span>
              <span class="text-muted" ng-if="!(reportGeneratedByProfit && reportGeneratedByProfit.email) && currentUser.email">&lt;{{currentUser.email}}&gt;</span>
            </div>
          </div>
        </div>
        <h2 class="report-title">BÁO CÁO LỢI NHUẬN</h2>
        <div class="mb-3">
          <table class="table table-bordered">
            <tbody>
              <tr><th style="width:40%">Số đơn hàng (đã thanh toán)</th><td class="text-end">{{profitReportData.ordersCount | number}}</td></tr>
              <tr><th>Doanh thu (thu tiền)</th><td class="text-end">{{profitReportData.revenue | vnNumber:0}} VNĐ</td></tr>
              <tr><th>Giá vốn hàng bán (COGS)</th><td class="text-end">{{profitReportData.cogs | vnNumber:0}} VNĐ</td></tr>
              <tr><th>Chi phí hoạt động</th><td class="text-end">{{profitReportData.opex | vnNumber:0}} VNĐ</td></tr>
              <tr class="table-light"><th>LỢI NHUẬN</th><td class="text-end fw-bold" ng-class="{'text-success': (profitReportData.profit||0) >= 0, 'text-danger': (profitReportData.profit||0) < 0}">{{profitReportData.profit | vnNumber:0}} VNĐ</td></tr>
            </tbody>
          </table>
        </div>
        <div class="fw-bold mt-4 mb-1" style="text-align:right">Người phê duyệt</div>
        <div class="fst-italic" style="text-align:right">(Ký và ghi rõ họ & tên)</div>
      </div>
      <div ng-if="!loadingProfit && !profitReportData" class="text-center text-muted">Chưa có dữ liệu xem chi tiết.</div>
    </div>
  </div>
        </div>

        </main>
    </div>
</div>

<!-- Original Admin Layout Styles (restored) -->
<style>
/* Admin Layout Styles */
.admin-layout {
    margin-top: 0 !important;
    padding-top: 0 !important;
    background-color: var(--gray-50);
    min-height: 100vh;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    overflow: hidden;
}

.admin-sidebar {
    background: linear-gradient(180deg, var(--primary-color), var(--primary-dark));
    height: 100vh;
    padding: 0;
    box-shadow: 4px 0 20px rgba(30, 58, 138, 0.15);
    position: fixed;
    top: 0;
    left: 0;
    z-index: 1000;
}

.admin-sidebar-content { padding: 2rem 0; height: 100vh; overflow-y: auto; }
.admin-sidebar-header { padding: 0 1.5rem 2rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 1rem; }
.admin-sidebar-title { color: white; font-weight: 700; font-size: 1.1rem; margin: 0; display: flex; align-items: center; gap: 0.5rem; }
.admin-nav-list { list-style: none; padding: 0; margin: 0; }
.admin-nav-item { margin: 0.25rem 0; }
.admin-nav-link { display: flex; align-items: center; gap: 0.75rem; padding: 1rem 1.5rem; color: rgba(255, 255, 255, 0.8); text-decoration: none; font-weight: 500; transition: all 0.3s ease; border-left: 3px solid transparent; position: relative; }
.admin-nav-link:hover { color: white; background-color: rgba(255, 255, 255, 0.1); border-left-color: var(--primary-light); transform: translateX(5px); }
.admin-nav-link.active { color: white; background-color: rgba(255, 255, 255, 0.15); border-left-color: white; font-weight: 600; }
.admin-nav-link i { font-size: 1.1rem; width: 20px; text-align: center; }

.admin-main-content { background-color: var(--gray-50); padding: 2rem; height: 100vh; overflow-y: auto; margin-left: 0; }

/* Card Enhancements */
.card { border: none; border-radius: 16px; box-shadow: 0 4px 20px rgba(30, 58, 138, 0.08); transition: all 0.3s ease; }
.card:hover { transform: translateY(-5px); box-shadow: 0 12px 40px rgba(30, 58, 138, 0.15); }
.card-header { background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white; border-radius: 16px 16px 0 0 !important; border: none; padding: 1.5rem; font-weight: 600; }

/* Responsive */
@media (max-width: 768px) {
    .admin-sidebar { position: fixed; top: 0; left: -100%; width: 280px; transition: left 0.3s ease; z-index: 1050; height: 100vh; }
    .admin-sidebar.show { left: 0; }
    .admin-main-content { margin-left: 0; padding: 1rem; }
}

/* Scrollbar */
.admin-sidebar-content::-webkit-scrollbar { width: 4px; }
.admin-sidebar-content::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); }
.admin-sidebar-content::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.3); border-radius: 2px; }
.admin-sidebar-content::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.5); }

/* Fix modal z-index + layout overrides */
.modal { z-index: 5000 !important; pointer-events: auto; }
.modal-backdrop { z-index: 4990 !important; opacity: 0.35 !important; background-color: #000 !important; }
.modal, .modal-backdrop { position: fixed !important; top: 0; left: 0; right: 0; bottom: 0; }
.modal-dialog, .modal-content { position: relative; z-index: 5001 !important; }

.dashboard-input-group {
  align-items: end !important;
  gap: 10px 12px;
}
.dashboard-input-group label.form-label {
  display: flex;
  align-items: center;
  height: 44px;
  font-weight: 500;
  color: #222;
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
}
.dashboard-input-group .form-select,
.dashboard-input-group .form-control,
.dashboard-input-group .btn {
  height: 44px !important;
  min-height: 44px !important;
  border-radius: 8px !important;
  box-shadow: none !important;
  font-size: 15px;
}
.dashboard-input-group .form-select {
  max-width: 120px !important;
  min-width: 100px !important;
}
.dashboard-input-group .btn {
  padding: 0 18px;
  font-weight: 500;
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
}
.dashboard-input-group .col-md-4, .dashboard-input-group .col-md-3, .dashboard-input-group .col-md-2, .dashboard-input-group .col-md-8, .dashboard-input-group .col-md-12, .dashboard-input-group .col-lg-9, .dashboard-input-group .col-lg-3, .dashboard-input-group .d-grid {
  display: flex;
  flex-direction: column;
  justify-content: end;
}

.dashboard-flex-form {
  display: flex;
  align-items: flex-end;
  gap: 16px;
  flex-wrap: nowrap;
}
.dashboard-flex-form label {
  font-size: 15px;
  height: 20px;
  font-weight: 500;
  padding-left: 2px;
  margin-bottom: 2px;
  color: #222;
}
.dashboard-flex-form .form-select {
  width: 110px;
  min-width: 110px;
  max-width: 130px;
  height: 44px !important;
  line-height: 44px !important;
  border-radius: 8px !important;
  padding: 0 10px;
}
.dashboard-flex-form .form-control {
  width: 150px;
  min-width: 120px;
  max-width: 170px;
  height: 44px !important;
  line-height: 44px !important;
  border-radius: 8px !important;
  font-size: 15px;
}
.dashboard-flex-form .btn {
  height: 44px !important;
  min-width: 120px;
  font-size: 15px;
  font-weight: 500;
  border-radius: 8px !important;
  padding: 0 24px;
  display: flex; align-items: center; justify-content: center;
  box-shadow: none !important;
}
.dashboard-flex-form > div {
  display: flex; flex-direction: column; justify-content: flex-end;
}

/* Report modal header styles */
.report-header { display:flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
.report-header .brand { display:flex; flex-direction: column; }
.report-header .brand-name { font-size: 28px; font-weight: 800; color:#8d6e3b; letter-spacing: .5px; }
.report-header .brand-sub { color:#6b7280; font-size: 12px; margin-top: 2px; }
.report-header .report-meta { font-size: 13px; color:#374151; }
.report-header .report-meta .meta-item { display:flex; gap:8px; justify-content:flex-end; }
.report-header .report-meta .meta-item span { color:#6b7280; min-width: 110px; text-align: right; }
.report-title { text-align:center; color:#132a42; font-weight: 700; margin: 6px 0 14px 0; }

/* Custom dashboard modal/backdrop */
.pie-chart { width: 220px; height: 220px; border-radius: 50%; box-shadow: inset 0 0 0 14px #fff, 0 6px 18px rgba(0,0,0,.08); }
.pie-legend .legend-dot { display:inline-block; width: 12px; height: 12px; border-radius: 3px; margin-right: 8px; }
.pie-legend li { font-size: 14px; color: #374151; }
.dashboard-backdrop {
  position: fixed; inset: 0; background: rgba(0,0,0,.45); z-index: 8998;
}
.dashboard-report-modal {
  position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%);
  width: 83vw; max-width: 1150px; min-width: 460px; max-height: 90vh;
  background: #fff; border-radius: 18px; box-shadow: 0 10px 50px #2227; overflow: hidden; padding: 0;
  z-index: 9000;
}
.dashboard-report-modal .modal-content { border: none; border-radius: 18px; box-shadow: none; }
.dashboard-report-modal .modal-header { border-bottom: 1px solid #f1f3f6; padding: 16px 22px; }
.dashboard-report-modal .modal-body { padding: 22px; overflow: auto; max-height: calc(90vh - 70px); }

/* Dedicated styles to avoid modal conflicts */
.inventory-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.45); z-index: 8996; }
.inventory-report-modal { position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%); width: 83vw; max-width: 1150px; min-width: 460px; max-height: 90vh; background:#fff; border-radius: 18px; box-shadow: 0 10px 50px #2227; overflow: hidden; padding:0; z-index: 8997; }
.inventory-report-modal .modal-content { border:none; border-radius:18px; box-shadow:none; }
.inventory-report-modal .modal-header { border-bottom:1px solid #f1f3f6; padding:16px 22px; }
.inventory-report-modal .modal-body { padding:22px; overflow:auto; max-height: calc(90vh - 70px); }

.profit-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.45); z-index: 10010; }
.profit-report-modal { position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%); width: 83vw; max-width: 1150px; min-width: 460px; max-height: 90vh; background:#fff; border-radius:18px; box-shadow:0 10px 50px #2227; overflow:hidden; padding:0; z-index: 10011; }
.profit-report-modal .modal-content { border:none; border-radius:18px; box-shadow:none; }
.profit-report-modal .modal-header { border-bottom:1px solid #f1f3f6; padding:16px 22px; }
.profit-report-modal .modal-body { padding:22px; overflow:auto; max-height: calc(90vh - 70px); }

/* Disable inner scrolling when custom dashboard modals are shown (avoid double scrollbars) */
.no-scroll { overflow: hidden !important; }

@media (max-width: 850px) {
  .dashboard-flex-form { flex-wrap: wrap; }
  .dashboard-flex-form .form-select,
  .dashboard-flex-form .form-control,
  .dashboard-flex-form .btn {
    width: 100%; max-width: unset;
  }
  .dashboard-flex-form > div { width: 100%; }
}
</style>

<!-- Toasts -->
<div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 2000;">
    <div class="toast align-items-center text-white bg-{{t.variant}} border-0 mb-2 show" role="alert" aria-live="assertive" aria-atomic="true" ng-repeat="t in toasts">
        <div class="d-flex">
            <div class="toast-body">{{t.message}}</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" ng-click="toasts.splice($index,1)"></button>
        </div>
    </div>
    </div>

